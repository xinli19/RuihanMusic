<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教学任务分配 - 睿涵音乐后台</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* 左侧导航栏 */
        .sidebar {
            width: 220px;
            background: #2d5a3d;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 4px rgba(0,0,0,0.1);
            transition: width 0.3s ease;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar-header {
            padding: 20px;
            background: #1e3a28;
            border-bottom: 1px solid #4a6b4a;
            position: relative;
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar.collapsed .sidebar-header h1 {
            opacity: 0;
        }

        .toggle-btn {
            position: absolute;
            top: 20px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .toggle-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 20px;
            color: #a8c8a8;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
        }

        .nav-item:hover {
            background: #1e3a28;
            color: white;
            border-left-color: #4CAF50;
        }

        .nav-item.active {
            background: #1e3a28;
            color: white;
            border-left-color: #4CAF50;
        }

        .sidebar.collapsed .nav-item {
            padding: 15px 10px;
            text-align: center;
        }

        .sidebar.collapsed .nav-item span {
            display: none;
        }
        
        /* 主内容区域调整 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h2 {
            color: #2c3e50;
            font-size: 24px;
            margin: 0;
        }
        
        .content {
            flex: 1;
            padding: 20px 30px;
            overflow-y: auto;
        }
        
        /* 功能选择区域 */
        .function-tabs {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .function-tabs h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .tab-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .tab-btn.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* 老师选择区域 */
        .teacher-stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .teacher-stats h3 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .stats-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            min-width: 80px;
            text-align: center;
        }
        
        .stat-teacher {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 2px;
            font-size: 14px;
        }
        
        .stat-count {
            font-size: 18px;
            font-weight: 600;
            color: #3498db;
        }
        
        /* 老师选择区域 */
        .teacher-selection {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .teacher-selection h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .teacher-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .teacher-btn {
            padding: 12px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .teacher-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .teacher-btn.active {
            background: #3498db;
            color: white;
        }
        
        /* 学员分配区域 */
        .student-assignment {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .assignment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .assignment-header h3 {
            color: #2c3e50;
            font-size: 18px;
        }
        
        .student-input-section {
            margin-bottom: 20px;
        }
        
        .student-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .student-suggestions {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            display: none;
        }
        
        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .suggestion-item:hover {
            background: #f8f9fa;
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        /* 已选学员列表 */
        .selected-students {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .student-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            gap: 15px;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .student-name {
            min-width: 120px;
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .student-name:hover {
            color: #3498db;
        }
        
        .task-remark {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-btn:hover {
            background: #c0392b;
        }
        
        /* 历史记录选择区域 */
        .history-selection {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .history-selection h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            background: #f8f9fa;
        }
        
        .history-item.selected {
            background: #e3f2fd;
            border-left: 4px solid #3498db;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-teacher {
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .history-date {
            color: #666;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .history-students {
            font-size: 14px;
            color: #555;
            line-height: 1.4;
        }
        
        .history-student-tag {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            margin-right: 5px;
            margin-bottom: 3px;
        }
        
        .history-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn-edit {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn-edit:hover {
            background: #e67e22;
        }
        
        .btn-use {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn-use:hover {
            background: #229954;
        }
        
        /* 操作按钮区域 */
        .action-buttons {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        /* 分配记录区域 */
        .assignment-records {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .assignment-records h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .records-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .records-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn-clear {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn-clear:hover {
            background: #c0392b;
        }
        
        .records-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .no-records {
            padding: 40px;
            text-align: center;
            color: #999;
            font-style: italic;
        }
        
        .record-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .record-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .record-teacher {
            font-weight: 600;
            color: #3498db;
            font-size: 16px;
        }
        
        .record-date {
            color: #666;
            font-size: 14px;
        }
        
        .record-students {
            margin-bottom: 10px;
        }
        
        .record-students-label {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .student-item-record {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 5px;
            position: relative;
        }
        
        .delete-btn {
            margin-left: 5px;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.7;
        }
        
        .delete-btn:hover {
            opacity: 1;
            color: #e74c3c;
        }
        
        .record-remarks {
            border-top: 1px solid #e9ecef;
            padding-top: 10px;
        }
        
        .record-remarks-label {
            font-weight: 500;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .record-remarks {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }
        
        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .student-detail {
            line-height: 1.6;
        }
        
        .detail-item {
            margin-bottom: 10px;
        }
        
        .detail-label {
            font-weight: 500;
            color: #555;
            display: inline-block;
            width: 100px;
        }
        
        /* 状态指示器 */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pending {
            background: #f39c12;
        }
        
        .status-assigned {
            background: #27ae60;
        }
        
        .status-completed {
            background: #3498db;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .teacher-buttons {
                flex-direction: column;
            }
            
            .student-item {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 左侧导航栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>教研中心</h1>
                <button class="toggle-btn" onclick="toggleSidebar()">☰</button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active">📋 <span>教学任务分配模块</span></a>
                <a href="#" class="nav-item">🔍 <span>教学质量控制模块</span></a>
            </nav>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="header">
                <h2>教学任务分配</h2>
            </div>
            
            <div class="content">
                <!-- 功能选择区域 -->
                <div class="function-tabs">
                    <h3>选择分配方式</h3>
                    <div class="tab-buttons">
                        <button class="tab-btn active" data-tab="manual">手动批量分配</button>
                        <button class="tab-btn" data-tab="history">从历史记录里分配</button>
                    </div>
                </div>
                
                <!-- 手动批量分配 -->
                <div id="manual-tab" class="tab-content active">
                    <!-- 老师选择区域 -->
                    <div class="teacher-selection">
                        <h3>1. 选择分配老师</h3>
                        <div class="teacher-buttons">
                            <button class="teacher-btn" data-teacher="王老师">王老师</button>
                            <button class="teacher-btn" data-teacher="钟老师">钟老师</button>
                            <button class="teacher-btn" data-teacher="李老师">李老师</button>
                            <button class="teacher-btn" data-teacher="黄老师">黄老师</button>
                        </div>
                    </div>
                    
                    <!-- 学员分配区域 -->
                    <div class="student-assignment">
                        <div class="assignment-header">
                            <h3>2. 添加学员并分配任务</h3>
                            <span id="selected-teacher-display" style="color: #3498db; font-weight: 500;">请先选择老师</span>
                        </div>
                        
                        <div class="student-input-section">
                            <input type="text" class="student-input" id="student-search" placeholder="输入学员姓名进行搜索..." autocomplete="off">
                            <div class="student-suggestions" id="student-suggestions"></div>
                        </div>
                        
                        <div class="selected-students" id="selected-students">
                            <div style="padding: 20px; text-align: center; color: #999;">暂无选择的学员</div>
                        </div>
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="confirmAssignment()">确认分配</button>
                        <button class="btn btn-warning" onclick="finishAssignment()">分配结束</button>
                        <button class="btn btn-secondary" onclick="exportResults()">导出结果</button>
                    </div>
                </div>
                
                <!-- 从历史记录里分配 -->
                <div id="history-tab" class="tab-content">
                    <div class="history-selection">
                        <h3>选择历史分配记录</h3>
                        <div class="history-list" id="history-list">
                            <div style="padding: 20px; text-align: center; color: #999;">暂无历史记录</div>
                        </div>
                        <div class="history-actions">
                            <button class="btn btn-success" onclick="useSelectedHistory()">使用选中记录</button>
                            <button class="btn btn-warning" onclick="editSelectedHistory()">编辑后使用</button>
                        </div>
                    </div>
                </div>
                
                <!-- 任务分配记录 -->
                <div class="assignment-records">
                    <div class="records-header">
                        <h3>分配记录</h3>
                        <div class="records-controls">
                            <span style="font-size: 14px; color: #666;">按老师排序</span>
                            <button class="btn-clear" onclick="clearAllRecords()">清空记录</button>
                        </div>
                    </div>
                    
                    <div class="records-list" id="records-list">
                        <div class="no-records">暂无分配记录</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 学员详情模态框 -->
    <div id="student-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>学员详情</h3>
                <span class="close" onclick="closeModal('student-detail-modal')">&times;</span>
            </div>
            <div class="student-detail" id="student-detail-content">
                <!-- 学员详情内容将在这里动态加载 -->
            </div>
        </div>
    </div>
    
    <script>
        // 模拟学员数据
        const studentsData = [
            { id: 1, name: '张小明', group: '基础班', progress: '第15课', status: '正常学习', remarks: '学习积极' },
            { id: 2, name: '李小红', group: '中级班', progress: '第8课', status: '正常学习', remarks: '需要加强练习' },
            { id: 3, name: '王小华', group: '高级班', progress: '第20课', status: '正常学习', remarks: '表现优秀' },
            { id: 4, name: '赵小丽', group: '基础班', progress: '第10课', status: '正常学习', remarks: '进度稍慢' },
            { id: 5, name: '陈小强', group: '视唱练耳', progress: '进行中', status: '正常学习', remarks: '音准需要提高' },
            { id: 6, name: '刘小芳', group: '中级班', progress: '第12课', status: '正常学习', remarks: '节奏感很好' },
            { id: 7, name: '孙小军', group: '基础班', progress: '第5课', status: '正常学习', remarks: '刚开始学习' },
            { id: 8, name: '周小美', group: '高级班', progress: '第18课', status: '正常学习', remarks: '技巧娴熟' }
        ];
        
        let selectedTeacher = '';
        let selectedStudents = [];
        let assignmentRecords = [];
        let selectedHistoryIndex = -1;
        
        // 模拟历史分配记录
        let historyRecords = [
            {
                teacher: '王老师',
                students: [
                    { id: 1, name: '张小明', group: '基础班', progress: '第15课', status: '正常学习', remarks: '学习积极', taskRemark: '加强基础练习' },
                    { id: 4, name: '赵小丽', group: '基础班', progress: '第10课', status: '正常学习', remarks: '进度稍慢', taskRemark: '需要耐心指导' }
                ],
                date: '2024-01-15'
            },
            {
                teacher: '李老师',
                students: [
                    { id: 2, name: '李小红', group: '中级班', progress: '第8课', status: '正常学习', remarks: '需要加强练习', taskRemark: '重点练习节拍' },
                    { id: 6, name: '刘小芳', group: '中级班', progress: '第12课', status: '正常学习', remarks: '节奏感很好', taskRemark: '可以尝试更难曲目' }
                ],
                date: '2024-01-10'
            },
            {
                teacher: '钟老师',
                students: [
                    { id: 3, name: '王小华', group: '高级班', progress: '第20课', status: '正常学习', remarks: '表现优秀', taskRemark: '准备考级曲目' },
                    { id: 8, name: '周小美', group: '高级班', progress: '第18课', status: '正常学习', remarks: '技巧娴熟', taskRemark: '加强表现力训练' }
                ],
                date: '2024-01-08'
            }
        ];
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            updateTeacherStats();
            updateRecordsTable();
            updateHistoryList();
        });
        
        // 初始化事件监听器
        function initializeEventListeners() {
            // 功能选项卡切换
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    switchTab(tabName);
                });
            });
            
            // 老师选择
            document.querySelectorAll('.teacher-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除其他按钮的active状态
                    document.querySelectorAll('.teacher-btn').forEach(b => b.classList.remove('active'));
                    // 添加当前按钮的active状态
                    this.classList.add('active');
                    
                    selectedTeacher = this.dataset.teacher;
                    document.getElementById('selected-teacher-display').textContent = `当前选择：${selectedTeacher}`;
                });
            });
            
            // 学员搜索
            const studentSearch = document.getElementById('student-search');
            const studentSuggestions = document.getElementById('student-suggestions');
            
            if (studentSearch) {
                studentSearch.addEventListener('input', function() {
                    const query = this.value.toLowerCase().trim();
                    
                    if (query.length === 0) {
                        studentSuggestions.style.display = 'none';
                        return;
                    }
                    
                    const filteredStudents = studentsData.filter(student => 
                        student.name.toLowerCase().includes(query) && 
                        !selectedStudents.some(s => s.id === student.id)
                    );
                    
                    if (filteredStudents.length > 0) {
                        studentSuggestions.innerHTML = filteredStudents.map(student => 
                            `<div class="suggestion-item" onclick="addStudent(${student.id})">
                                ${student.name} - ${student.group} - ${student.progress}
                            </div>`
                        ).join('');
                        studentSuggestions.style.display = 'block';
                    } else {
                        studentSuggestions.style.display = 'none';
                    }
                });
            }
        }
        
        // 切换功能选项卡
        function switchTab(tabName) {
            // 更新按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });
            
            // 更新内容显示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // 重置选择状态
            if (tabName === 'manual') {
                selectedHistoryIndex = -1;
                updateHistorySelection();
            } else if (tabName === 'history') {
                // 清空手动选择的老师和学员
                selectedTeacher = '';
                selectedStudents = [];
                document.querySelectorAll('.teacher-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('selected-teacher-display').textContent = '请先选择老师';
                updateSelectedStudentsList();
            }
        }
        
        // 更新历史记录列表
        function updateHistoryList() {
            const historyList = document.getElementById('history-list');
            
            if (historyRecords.length === 0) {
                historyList.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">暂无历史记录</div>';
                return;
            }
            
            historyList.innerHTML = historyRecords.map((record, index) => {
                const studentsHtml = record.students.map(student => 
                    `<span class="history-student-tag">${student.name}</span>`
                ).join('');
                
                return `
                    <div class="history-item ${selectedHistoryIndex === index ? 'selected' : ''}" onclick="selectHistory(${index})">
                        <div class="history-teacher">${record.teacher}</div>
                        <div class="history-date">分配时间：${record.date}</div>
                        <div class="history-students">
                            <strong>学员列表：</strong><br>
                            ${studentsHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 选择历史记录
        function selectHistory(index) {
            selectedHistoryIndex = index;
            updateHistorySelection();
        }
        
        // 更新历史记录选择状态
        function updateHistorySelection() {
            document.querySelectorAll('.history-item').forEach((item, index) => {
                if (index === selectedHistoryIndex) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
        }
        
        // 使用选中的历史记录
        function useSelectedHistory() {
            if (selectedHistoryIndex === -1) {
                alert('请先选择一个历史记录！');
                return;
            }
            
            const historyRecord = historyRecords[selectedHistoryIndex];
            
            // 直接添加到分配记录
            assignmentRecords.push({
                teacher: historyRecord.teacher,
                students: [...historyRecord.students],
                date: new Date().toISOString().split('T')[0]
            });
            
            updateTeacherStats();
            updateRecordsTable();
            
            alert(`已成功使用历史记录，将 ${historyRecord.students.length} 名学员分配给 ${historyRecord.teacher}！`);
        }
        
        // 编辑后使用历史记录
        function editSelectedHistory() {
            if (selectedHistoryIndex === -1) {
                alert('请先选择一个历史记录！');
                return;
            }
            
            const historyRecord = historyRecords[selectedHistoryIndex];
            
            // 切换到手动分配模式
            switchTab('manual');
            
            // 设置老师
            selectedTeacher = historyRecord.teacher;
            document.querySelectorAll('.teacher-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.teacher === selectedTeacher) {
                    btn.classList.add('active');
                }
            });
            document.getElementById('selected-teacher-display').textContent = `当前选择：${selectedTeacher}`;
            
            // 设置学员列表
            selectedStudents = [...historyRecord.students];
            updateSelectedStudentsList();
            
            alert('已加载历史记录到编辑模式，您可以进行修改后再分配！');
        }
        
        // 更新老师统计
        function updateTeacherStats() {
            const teachers = ['王老师', '钟老师', '李老师', '黄老师'];
            const statsGrid = document.querySelector('.stats-grid');
            
            if (statsGrid) {
                statsGrid.innerHTML = teachers.map(teacher => {
                    const count = assignmentRecords.reduce((total, record) => {
                        return record.teacher === teacher ? total + record.students.length : total;
                    }, 0);
                    
                    return `
                        <div class="stat-card">
                            <div class="stat-teacher">${teacher}</div>
                            <div class="stat-count">${count}人</div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        // 添加学员
        function addStudent(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (student && !selectedStudents.some(s => s.id === studentId)) {
                selectedStudents.push({...student, taskRemark: ''});
                updateSelectedStudentsList();
                document.getElementById('student-search').value = '';
                document.getElementById('student-suggestions').style.display = 'none';
            }
        }
        
        // 更新已选学员列表
        function updateSelectedStudentsList() {
            const container = document.getElementById('selected-students');
            
            if (selectedStudents.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">暂无选择的学员</div>';
                return;
            }
            
            container.innerHTML = selectedStudents.map((student, index) => 
                `<div class="student-item">
                    <span class="student-name" onclick="showStudentDetail(${student.id})">${student.name}</span>
                    <input type="text" class="task-remark" placeholder="输入任务备注..." 
                           value="${student.taskRemark}" 
                           onchange="updateTaskRemark(${index}, this.value)">
                    <button class="remove-btn" onclick="removeStudent(${index})">移除</button>
                </div>`
            ).join('');
        }
        
        // 更新任务备注
        function updateTaskRemark(index, remark) {
            selectedStudents[index].taskRemark = remark;
        }
        
        // 移除学员
        function removeStudent(index) {
            selectedStudents.splice(index, 1);
            updateSelectedStudentsList();
        }
        
        // 显示学员详情
        function showStudentDetail(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (student) {
                document.getElementById('student-detail-content').innerHTML = `
                    <div class="detail-item">
                        <span class="detail-label">姓名：</span>${student.name}
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">所属班级：</span>${student.group}
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">学习进度：</span>${student.progress}
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">学员状态：</span>${student.status}
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">备注：</span>${student.remarks}
                    </div>
                `;
                document.getElementById('student-detail-modal').style.display = 'block';
            }
        }
        
        // 确认分配
        function confirmAssignment() {
            if (!selectedTeacher) {
                alert('请先选择老师！');
                return;
            }
            
            if (selectedStudents.length === 0) {
                alert('请至少选择一个学员！');
                return;
            }
            
            // 添加到分配记录
            assignmentRecords.push({
                teacher: selectedTeacher,
                students: [...selectedStudents],
                date: new Date().toISOString().split('T')[0] // 只保留日期部分
            });
            
            updateTeacherStats();
            updateRecordsTable();
            
            // 清空当前选择
            const studentCount = selectedStudents.length;
            selectedStudents = [];
            updateSelectedStudentsList();
            
            alert(`已成功将 ${studentCount} 名学员分配给 ${selectedTeacher}！`);
        }
        
        // 更新分配记录列表
        function updateRecordsTable() {
            const recordsList = document.getElementById('records-list');
            
            if (!recordsList) return;
            
            if (assignmentRecords.length === 0) {
                recordsList.innerHTML = '<div class="no-records">暂无分配记录</div>';
                return;
            }
            
            // 按老师排序
            let sortedRecords = [...assignmentRecords];
            sortedRecords.sort((a, b) => a.teacher.localeCompare(b.teacher));
            
            recordsList.innerHTML = sortedRecords.map((record, recordIndex) => {
                const studentsHtml = record.students.map((student, studentIndex) => 
                    `<span class="student-item-record">${student.name}<span class="delete-btn" onclick="removeStudentFromRecord(${recordIndex}, ${studentIndex})" title="删除学员">×</span></span>`
                ).join('');
                
                const remarksHtml = record.students.map(student => 
                    `${student.name}: ${student.taskRemark || '无备注'}`
                ).join('<br>');
                
                return `
                    <div class="record-item">
                        <div class="record-header">
                            <div class="record-teacher">${record.teacher}</div>
                            <div class="record-date">${record.date}</div>
                        </div>
                        <div class="record-students">
                            <div class="record-students-label">分配学员：</div>
                            ${studentsHtml}
                        </div>
                        <div class="record-remarks">
                            <div class="record-remarks-label">任务备注：</div>
                            ${remarksHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // 从分配记录中删除学员
        function removeStudentFromRecord(recordIndex, studentIndex) {
            if (confirm('确定要删除这个学员的任务分配吗？')) {
                assignmentRecords[recordIndex].students.splice(studentIndex, 1);
                
                // 如果该记录没有学员了，删除整个记录
                if (assignmentRecords[recordIndex].students.length === 0) {
                    assignmentRecords.splice(recordIndex, 1);
                }
                
                updateTeacherStats();
                updateRecordsTable();
            }
        }
        
        // 清空所有分配记录
        function clearAllRecords() {
            if (assignmentRecords.length === 0) {
                alert('暂无分配记录！');
                return;
            }
            
            if (confirm('确定要清空所有分配记录吗？此操作不可撤销！')) {
                assignmentRecords = [];
                updateTeacherStats();
                updateRecordsTable();
                alert('已清空所有分配记录！');
            }
        }
        
        // 分配结束
        function finishAssignment() {
            if (assignmentRecords.length === 0) {
                alert('暂无分配记录！');
                return;
            }
            
            alert('任务分配已完成！总表单将发送给运营端口。');
        }
        
        // 导出结果
        function exportResults() {
            if (assignmentRecords.length === 0) {
                alert('暂无分配记录可导出！');
                return;
            }
            
            let exportData = '教学任务分配结果\n\n';
            assignmentRecords.forEach((record, index) => {
                exportData += `分配 ${index + 1}：\n`;
                exportData += `老师：${record.teacher}\n`;
                exportData += `时间：${record.date}\n`;
                exportData += `学员列表：\n`;
                record.students.forEach(student => {
                    exportData += `  - ${student.name} (${student.group}) - 备注：${student.taskRemark || '无'}\n`;
                });
                exportData += '\n';
            });
            
            // 创建下载链接
            const blob = new Blob([exportData], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `教学任务分配结果_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 关闭模态框
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // 点击模态框外部关闭
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
        
        // 隐藏建议列表当点击其他地方
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.student-input-section')) {
                const suggestions = document.getElementById('student-suggestions');
                if (suggestions) {
                    suggestions.style.display = 'none';
                }
            }
        });
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            sidebar.classList.toggle('collapsed');
        }
    </script>
</body>
</html>