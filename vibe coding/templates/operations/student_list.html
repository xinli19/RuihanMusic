{% extends 'base.html' %}
{% load static %}

{% block title %}å­¦å‘˜ä¿¡æ¯ç®¡ç† - ç¿æ¶µéŸ³ä¹åå°{% endblock %}

{% block page_title %}å­¦å‘˜ä¿¡æ¯ä¸­å¿ƒ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/operations.css' %}">
<link rel="stylesheet" href="{% static 'css/teaching.css' %}?v=dev2">
{% endblock %}

{% block content %}
<div class="operations-container">
    <div class="module-tabs">
        <div class="tabs">
            <div class="tab-header">
                <button class="tab-button active" data-tab="studentManagement" type="button">å­¦å‘˜ä¿¡æ¯ç®¡ç†</button>
                <button class="tab-button" data-tab="opsTaskManagement" type="button">è¿è¥ä»»åŠ¡ç®¡ç†</button>
            </div>

            <!-- å­¦å‘˜ä¿¡æ¯ç®¡ç† -->
            <div id="studentManagement" class="tab-pane active">
                <!-- é¡µé¢æ“ä½œåŒºï¼ˆæ”¾å…¥å¡ç‰‡ï¼‰ -->
                <div class="ops-card">
                    <div class="ops-header">
                        <div class="ops-actions">
                            <button class="btn btn-success" onclick="openAddStudentModal()">æ·»åŠ å­¦å‘˜</button>
                            <button class="btn btn-info" onclick="openBatchImportModal()">æ‰¹é‡å¯¼å…¥</button>
                            <button class="btn btn-warning" onclick="exportStudents()">å¯¼å‡ºæ•°æ®</button>
                        </div>
                    </div>
                </div>

                <!-- æœç´¢åŒºï¼ˆåªåŒ…å«æœç´¢ï¼‰ -->
                <div class="ops-search">
                    <div class="search-input-group">
                        <span class="search-icon"> </span>
                        <input type="text" id="student-mgr-search" class="search-input" placeholder="æœç´¢å­¦å‘˜æ˜µç§°ã€å¤‡æ³¨åã€ç”¨æˆ·ID...">
                    </div>
                    <button type="button" class="btn btn-primary" id="student-mgr-search-btn">æœç´¢</button>
                </div>

                <div id="student-mgr-results" class="table-container" style="display:none;"></div>
            </div>

            <!-- è¿è¥ä»»åŠ¡ç®¡ç† Tab -->
            <div id="opsTaskManagement" class="tab-pane">
                <div class="toolbar">
                    <!-- ä¸‹çº¿æœç´¢æ¡†ï¼šç§»é™¤ -->
                    <div class="actions-section">
                        <button class="btn btn-danger" id="ops-batch-delete" disabled>æ‰¹é‡åˆ é™¤</button>
                        <button class="btn btn-info" id="ops-export" disabled>å¯¼å‡ºåˆ—è¡¨</button>
                    </div>
                </div>

                <!-- åˆ é™¤ï¼šæœç´¢ç»“æœå®¹å™¨ <div id="ops-student-results"> -->
                <div id="ops-task-list" class="table-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ—‚ï¸</div>
                        <p>è¿è¥ä»»åŠ¡åˆ—è¡¨åŠ è½½ä¸­/æˆ–æš‚æ— æ•°æ®</p>
                    </div>
                </div>
                <div id="ops-task-pagination" class="pagination"></div>
            </div>
        </div>
    </div>
</div>

<!-- å­¦å‘˜è¯¦æƒ…æŠ½å±‰ï¼ˆå»å†…è”æ ·å¼ï¼Œç»Ÿä¸€é£æ ¼ï¼‰ -->
<div id="studentDetailDrawerMask" class="drawer-mask" style="display:none;"></div>
<div id="studentDetailDrawer" class="drawer" style="display:none;">
    <div id="studentDetailDrawerContent" class="drawer-content"></div>
</div>

<!-- å­¦å‘˜æ·»åŠ /ç¼–è¾‘æ¨¡æ€æ¡† -->
<div id="studentModal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">ç¼–è¾‘å­¦å‘˜</h3>
            <span class="close" onclick="closeStudentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="studentForm">
                <input type="hidden" id="studentId" name="student_id" />
                <div class="form-group">
                    <label for="studentName">å­¦å‘˜æ˜µç§°</label>
                    <input type="text" id="studentName" name="student_name" class="form-control" required />
                </div>
                <div class="form-group">
                    <label for="aliasName">å¤‡æ³¨å</label>
                    <input type="text" id="aliasName" name="alias_name" class="form-control" />
                </div>
                <div class="form-group">
                    <label for="groupName">åˆ†ç»„ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
                    <input type="text" id="groupName" name="group_name" class="form-control" placeholder="å¦‚ï¼šAç»„,Bç»„" />
                </div>
                <div class="form-group">
                    <label for="status">çŠ¶æ€</label>
                    <select id="status" name="status" class="form-control">
                        <option value="active">active</option>
                        <option value="inactive">inactive</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeStudentModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- æ‰¹é‡å¯¼å…¥æ¨¡æ€æ¡† -->
<div id="batchImportModal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>æ‰¹é‡å¯¼å…¥å­¦å‘˜</h3>
            <span class="close" onclick="closeBatchImportModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p class="muted">è¯·ä¸Šä¼  .xlsx æ–‡ä»¶ï¼Œéœ€åŒ…å«åˆ—ï¼šç”¨æˆ·IDã€æ˜µç§°</p>
            <input type="file" id="importFile" accept=".xlsx" />
            <div class="form-actions">
                <button class="btn" onclick="closeBatchImportModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitBatchImport()">å¼€å§‹å¯¼å…¥</button>
            </div>
            <div id="batchImportResult" class="import-result"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/operations.js' %}"></script>
{% endblock %}