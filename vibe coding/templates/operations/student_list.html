{% extends 'base.html' %}
{% load static %}

{% block title %}学员信息管理 - 睿涵音乐后台{% endblock %}

{% block page_title %}学员信息中心{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/operations.css' %}">
<link rel="stylesheet" href="{% static 'css/teaching.css' %}?v=dev2">
{% endblock %}

{% block content %}
<div class="operations-container">
    <div class="module-tabs">
        <div class="tabs">
            <div class="tab-header">
                <button class="tab-button active" data-tab="studentManagement" type="button">学员信息管理</button>
                <button class="tab-button" data-tab="opsTaskManagement" type="button">运营任务管理</button>
            </div>

            <!-- 学员信息管理 -->
            <div id="studentManagement" class="tab-pane active">
                <!-- 页面操作区（放入卡片） -->
                <div class="ops-card">
                    <div class="ops-header">
                        <div class="ops-actions">
                            <button class="btn btn-success" onclick="openAddStudentModal()">添加学员</button>
                            <button class="btn btn-info" onclick="openBatchImportModal()">批量导入</button>
                            <button class="btn btn-warning" onclick="exportStudents()">导出数据</button>
                        </div>
                    </div>
                </div>

                <!-- 搜索区（只包含搜索） -->
                <div class="ops-search">
                    <div class="search-input-group">
                        <span class="search-icon"> </span>
                        <input type="text" id="student-mgr-search" class="search-input" placeholder="搜索学员昵称、备注名、用户ID...">
                    </div>
                    <button type="button" class="btn btn-primary" id="student-mgr-search-btn">搜索</button>
                </div>

                <div id="student-mgr-results" class="table-container" style="display:none;"></div>
            </div>

            <!-- 运营任务管理 Tab -->
            <div id="opsTaskManagement" class="tab-pane">
                <div class="toolbar">
                    <!-- 下线搜索框：移除 -->
                    <div class="actions-section">
                        <button class="btn btn-danger" id="ops-batch-delete" disabled>批量删除</button>
                        <button class="btn btn-info" id="ops-export" disabled>导出列表</button>
                    </div>
                </div>

                <!-- 删除：搜索结果容器 <div id="ops-student-results"> -->
                <div id="ops-task-list" class="table-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">🗂️</div>
                        <p>运营任务列表加载中/或暂无数据</p>
                    </div>
                </div>
                <div id="ops-task-pagination" class="pagination"></div>
            </div>
        </div>
    </div>
</div>

<!-- 学员详情抽屉（去内联样式，统一风格） -->
<div id="studentDetailDrawerMask" class="drawer-mask" style="display:none;"></div>
<div id="studentDetailDrawer" class="drawer" style="display:none;">
    <div id="studentDetailDrawerContent" class="drawer-content"></div>
</div>

<!-- 学员添加/编辑模态框 -->
<div id="studentModal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">编辑学员</h3>
            <span class="close" onclick="closeStudentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="studentForm">
                <input type="hidden" id="studentId" name="student_id" />
                <div class="form-group">
                    <label for="studentName">学员昵称</label>
                    <input type="text" id="studentName" name="student_name" class="form-control" required />
                </div>
                <div class="form-group">
                    <label for="aliasName">备注名</label>
                    <input type="text" id="aliasName" name="alias_name" class="form-control" />
                </div>
                <div class="form-group">
                    <label for="groupName">分组（逗号分隔）</label>
                    <input type="text" id="groupName" name="group_name" class="form-control" placeholder="如：A组,B组" />
                </div>
                <div class="form-group">
                    <label for="status">状态</label>
                    <select id="status" name="status" class="form-control">
                        <option value="joined">加入</option>
                        <option value="active">活跃</option>
                        <option value="graduated">已毕业</option>
                        <option value="archived">已归档</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn" onclick="closeStudentModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 批量导入模态框 -->
<div id="batchImportModal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>批量导入学员</h3>
            <span class="close" onclick="closeBatchImportModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p class="muted">请上传 .xlsx 文件，需包含列：用户ID、昵称</p>
            <input type="file" id="importFile" accept=".xlsx" />
            <div class="form-actions">
                <button class="btn" onclick="closeBatchImportModal()">取消</button>
                <button class="btn btn-primary" onclick="submitBatchImport()">开始导入</button>
            </div>
            <div id="batchImportResult" class="import-result"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/operations.js' %}"></script>
{% endblock %}