{% extends 'base.html' %}
{% load static %}

{% block title %}教师点评 - 睿涵音乐后台{% endblock %}

{% block page_title %}学员点评{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/teaching.css' %}?v=dev2">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/teaching.js' %}?v=dev2"></script>
{% endblock %}

{% block content %}
<div class="teaching-container">
    <!-- 公告栏（按原型结构） -->
    <div class="announcement-board">
        <div class="announcement-header">公告栏</div>
        <div class="announcement-content">
            <div class="announcement-section">
                <h4>教学提示</h4>
                <div class="announcement-list">
                    {% if announcements.teaching_tips %}
                        {% for tip in announcements.teaching_tips %}
                            <div class="announcement-item">{{ tip }}</div>
                        {% endfor %}
                    {% else %}
                        <div class="announcement-item">暂无教学提示</div>
                    {% endif %}
                </div>
            </div>
            <div class="announcement-section">
                <h4>重点关注学员</h4>
                <div class="announcement-list">
                    {% if announcements.student_notes %}
                        {% for note in announcements.student_notes %}
                            <div class="announcement-item">{{ note }}</div>
                        {% endfor %}
                    {% else %}
                        <div class="announcement-item">暂无重点关注学员</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="module-tabs">
        <div class="tab-header">
            <button class="tab-button active" data-tab="todayTasks">今日任务</button>
            <button class="tab-button" data-tab="completedComments">已点评记录</button>
            <button class="tab-button" data-tab="manualComment">手动点评</button>
        </div>
        <div class="tab-content">
            <div id="todayTasks" class="tab-pane active">
                <!-- 批量操作栏 -->
                <div class="action-bar">
                    <label><input type="checkbox" id="today-select-all"> 全选</label>
                    <div class="spacer"></div>
                    <button class="btn" id="btn-refresh-tasks">更新今日任务</button>
                    <button class="btn btn-secondary" id="btn-push-research" disabled>批量推送教研</button>
                    <button class="btn btn-secondary" id="btn-push-ops" disabled>批量推送运营</button>
                    <button class="btn btn-primary" id="btn-batch-submit" disabled>批量提交点评</button>
                    <button class="btn btn-danger" id="btn-batch-delete" disabled>批量删除</button>
                </div>
                <!-- 今日任务表格骨架 -->
                <table class="task-table" id="today-task-table">
                    <thead>
                        <tr>
                            <th style="width:40px;"></th>
                            <th>学员昵称</th>
                            <th style="width:220px;">本次进度（progress）</th>
                            <th>教师评语（teacher_comment）</th>
                            <th style="width:180px;">推送教研（push_research）</th>
                            <th style="width:180px;">推送运营（push_ops）</th>
                            <th style="width:140px;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 数据加载前的占位空态；后续由 JS 渲染 -->
                        <tr class="empty-row"><td colspan="7" class="empty-state">暂无今日任务</td></tr>
                    </tbody>
                </table>
                <div class="table-footer-hint">提交成功后保留在列表并标记为“已提交”。</div>
            </div>

            <div id="completedComments" class="tab-pane">
                <!-- 已点评记录表格骨架 -->
                <table class="task-table" id="completed-table">
                    <thead>
                        <tr>
                            <th style="width:160px;">时间（reply_time）</th>
                            <th>学员昵称（student_name）</th>
                            <th>进度（progress）</th>
                            <th style="width:120px;">老师（teacher_name）</th>
                            <th>评语（teacher_comment）</th>
                            <th style="width:140px;">推送教研</th>
                            <th style="width:140px;">推送运营</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="empty-row"><td colspan="7" class="empty-state">暂无记录</td></tr>
                    </tbody>
                </table>
                <div class="pagination-bar" id="completed-pagination">
                    <!-- 分页占位，后续由 JS 渲染 -->
                </div>
            </div>

            <div id="manualComment" class="tab-pane">
                <!-- 搜索与结果 -->
                <div class="search-bar">
                    <input id="manual-search-input" class="form-input" type="text" placeholder="输入学员昵称/ID搜索...">
                    <button id="manual-search-btn" class="btn btn-primary">搜索学员</button>
                </div>
                <table class="task-table" id="manual-search-result">
                    <thead>
                        <tr>
                            <th style="width:40px;"></th>
                            <th>学员昵称（student_name）</th>
                            <th>分组（groups）</th>
                            <th>状态（status）</th>
                            <th>当前进度（progress）</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="empty-row"><td colspan="5" class="empty-state">请先搜索学员</td></tr>
                    </tbody>
                </table>
                <!-- 手动点评表单 -->
                <div class="panel">
                    <div class="panel-header">手动点评表单</div>
                    <div class="panel-content">
                        <div class="form-row">
                            <label class="form-label">选中学员：</label>
                            <span id="manual-selected-student">未选择</span>
                        </div>
                        <div class="form-row">
                            <label class="form-label" for="manual-progress">本次进度（progress）</label>
                            <input id="manual-progress" class="form-input" type="text" placeholder='如：6.1, 6.2, 7'>
                        </div>
                        <div class="form-row">
                            <label class="form-label" for="manual-comment">教师评语（teacher_comment）</label>
                            <textarea id="manual-comment" class="form-input form-textarea" placeholder="可选填写"></textarea>
                        </div>
                        <div class="form-row">
                            <label class="form-label" for="manual-push-research">推送教研（push_research）</label>
                            <input id="manual-push-research" class="form-input" type="text" placeholder="可选填写"></input>
                        </div>
                        <div class="form-row">
                            <label class="form-label" for="manual-push-ops">推送运营（push_ops）</label>
                            <input id="manual-push-ops" class="form-input" type="text" placeholder="可选填写"></input>
                        </div>
                        <div class="action-bar">
                            <button id="manual-submit" class="btn btn-primary" disabled>提交点评</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 推送模态框（移入 content 内） -->
    <div id="pushModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pushModalTitle">推送到部门</h2>
                <span class="close" onclick="closePushModal()">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label" id="pushModalLabel">备注信息</label>
                <textarea class="form-input form-textarea" id="pushNote" placeholder="请输入备注信息..."></textarea>
            </div>
            <div class="action-bar">
                <button class="btn btn-primary" onclick="confirmPush()">确认推送</button>
                <button class="btn btn-secondary" onclick="closePushModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 学员信息模态框 -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>学员信息</h2>
                <span class="close" onclick="closeStudentModal()">&times;</span>
            </div>
            <div id="studentModalContent">
                <!-- 学员详细信息将通过AJAX加载 -->
            </div>
        </div>
    </div>
</div>
{% endblock %}