{% extends 'base.html' %}
{% load static %}

{% block title %}教师点评 - 睿涵音乐后台{% endblock %}

{% block page_title %}学员点评{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/teaching.css' %}?v=dev2">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/teaching.js' %}?v=dev2"></script>
{% endblock %}

{% block content %}
<div class="teaching-container">
    <!-- 公告栏（按原型结构） -->
    <div class="announcement-board">
        <div class="announcement-header">公告栏</div>
        <div class="announcement-content">
            <div class="announcement-section">
                <h4>教研备注/任务备注</h4>
                <div class="announcement-list">
                    {% if announcements.notes_from_research %}
                        {% for tip in announcements.notes_from_research %}
                            <div class="announcement-item">{{ tip }}</div>
                        {% endfor %}
                    {% else %}
                        <div class="announcement-item">暂无教研备注/任务备注</div>
                    {% endif %}
                </div>
            </div>
            <div class="announcement-section">
                <h4>运营备注</h4>
                <div class="announcement-list">
                    {% if announcements.notes_from_ops %}
                        {% for note in announcements.notes_from_ops %}
                            <div class="announcement-item">{{ note }}</div>
                        {% endfor %}
                    {% else %}
                        <div class="announcement-item">暂无运营备注</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="module-tabs">
        <div class="tabs">
            <div class="tab-header">
                <button class="tab-button active" data-tab="todayTasks">今日任务</button>
                <button class="tab-button" data-tab="completedComments">已完成点评</button>
            </div>
            <div id="todayTasks" class="tab-pane active">
                <div class="toolbar" id="today-add-toolbar" style="margin-bottom:10px;">
                    <input id="today-add-search-input" class="form-input" type="text" placeholder="输入学员昵称/ID 搜索添加到今日任务...">
                    <button id="today-add-search-btn" class="btn btn-primary" style="margin-left:8px;">搜索</button>
                </div>
                <div id="today-add-search-result" class="search-result"></div>
    
                <!-- 批量操作栏：恢复 -->
                <div class="action-bar">
                    <button id="btn-push-research" class="btn btn-secondary" disabled>推送教研</button>
                    <button id="btn-push-ops" class="btn btn-secondary" disabled>推送运营</button>
                    <span class="spacer"></span>
                    <button id="btn-batch-submit" class="btn btn-primary" disabled>批量提交点评</button>
                    <button id="btn-batch-delete" class="btn btn-danger" disabled>批量删除</button>
                </div>
    
                <table class="task-table" id="today-task-table">
                    <thead>
                        <tr>
                            <th style="width:40px;">
                                <input type="checkbox" id="today-select-all">
                            </th>
                            <th>学员昵称</th>
                            <th style="width:220px;">本次进度</th>
                            <th>教师评语</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 列表内容由 teaching.js 渲染 -->
                    </tbody>
                </table>
            </div>
            <!-- 已完成点评 -->
            <div id="completedComments" class="tab-pane">
                <!-- 已点评记录表格骨架 -->
                <table class="task-table" id="completed-table">
                    <thead>
                        <tr>
                            <th style="width:160px;">时间</th>
                            <th>学员昵称</th>
                            <th>进度</th>
                            <th style="width:120px;">老师</th>
                            <th>评语</th>
                            <th style="width:140px;">推送教研</th>
                            <th style="width:140px;">推送运营</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="empty-row"><td colspan="7" class="empty-state">暂无记录</td></tr>
                    </tbody>
                </table>
                <div class="pagination-bar" id="completed-pagination">
                    <!-- 分页占位，后续由 JS 渲染 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 推送模态框（移入 content 内） -->
    <div id="pushModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="pushModalTitle">推送到部门</h2>
                <span class="close" onclick="closePushModal()">&times;</span>
            </div>
            <div class="form-group">
                <label class="form-label" id="pushModalLabel">备注信息</label>
                <textarea class="form-input form-textarea" id="pushNote" placeholder="请输入备注信息..."></textarea>
            </div>
            <div class="action-bar">
                <button class="btn btn-primary" onclick="confirmPush()">确认推送</button>
                <button class="btn btn-secondary" onclick="closePushModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 学员信息模态框 -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>学员信息</h2>
                <span class="close" onclick="closeStudentModal()">&times;</span>
            </div>
            <div id="studentModalContent">
                <!-- 学员详细信息将通过AJAX加载 -->
            </div>
        </div>
    </div>
    </div>
    {% endblock %}